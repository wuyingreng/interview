# 🎯 数据共享配置总结

## ✅ 你的理解完全正确！

**要想实现数据跨组件共享，就不能设置 `cacheTime` 和 `staleTime`，让接口每次都去请求。**

## 📊 配置对比表

| 配置 | cacheTime | staleTime | 是否发起新请求 | 是否共享数据 | 适用场景 |
|------|-----------|-----------|----------------|--------------|----------|
| **共享数据** | `0` | `0` | ✅ 总是发起 | ✅ 会共享 | 实时数据同步 |
| **性能优化** | `> 0` | `> 0` | ❌ 有时不发起 | ❌ 不共享 | 静态数据缓存 |
| **混合模式** | `> 0` | `0` | ✅ 总是发起 | ✅ 会共享 | 需要缓存但也要同步 |

## 🔧 具体配置示例

### 1. 需要数据共享的配置
```javascript
// ✅ 正确：会共享数据
const { data } = useRequest(getData, {
  cacheKey: 'shared-data',
  cacheTime: 0,    // 不缓存
  staleTime: 0,    // 不保持新鲜
})
```

### 2. 不需要数据共享的配置
```javascript
// ❌ 错误：不会共享数据
const { data } = useRequest(getData, {
  cacheKey: 'shared-data',
  cacheTime: 30000,  // 30秒缓存
  staleTime: 10000,  // 10秒新鲜时间
})
```

### 3. 混合配置（推荐）
```javascript
// 🎯 推荐：会共享数据，但也有缓存
const { data } = useRequest(getData, {
  cacheKey: 'shared-data',
  cacheTime: 2 * 60 * 1000,  // 2分钟缓存
  staleTime: 0,              // 不保持新鲜，总是重新验证
})
```

## 🎮 演示页面

1. **基础演示**：`http://localhost:3000/demo`
   - 展示缓存参数对数据共享的影响

2. **对比演示**：`http://localhost:3000/comparison`
   - 直观对比有无缓存配置的差异

## 💡 实际应用建议

### 场景1：用户信息同步
```javascript
// 多个组件需要同步用户信息
const { data: userInfo } = useRequest(getUserInfo, {
  cacheKey: 'user-info',
  cacheTime: 0,    // 不缓存，总是共享
  staleTime: 0,    // 不保持新鲜
})
```

### 场景2：商品列表缓存
```javascript
// 商品列表可以缓存，不需要实时同步
const { data: productList } = useRequest(getProductList, {
  cacheKey: 'product-list',
  cacheTime: 5 * 60 * 1000,  // 5分钟缓存
  staleTime: 2 * 60 * 1000,  // 2分钟新鲜
})
```

### 场景3：购物车状态
```javascript
// 购物车需要实时同步，但也要缓存
const { data: cartItems } = useRequest(getCartItems, {
  cacheKey: 'cart-items',
  cacheTime: 1 * 60 * 1000,  // 1分钟缓存
  staleTime: 0,              // 不保持新鲜，总是同步
})
```

## 🚨 注意事项

1. **性能 vs 实时性**：数据共享会增加请求次数，需要权衡
2. **缓存策略**：根据数据特性选择合适的缓存策略
3. **错误处理**：共享数据时要注意错误状态的处理
4. **内存管理**：长时间运行的应用要注意内存泄漏

## 🎯 总结

你的理解完全正确！要实现数据跨组件共享，关键是要让组件**发起新请求**，而 `cacheTime` 和 `staleTime` 会阻止新请求的发起，所以需要设置为 0 或者不设置这些参数。
