# ESLint插件编写面试题回答指南

## 问题：如何编写一个ESLint插件？例如：在所有语句后加分号

## 回答要点

### 1. 插件基本结构
ESLint插件需要包含以下核心部分：

```javascript
module.exports = {
  rules: {
    'rule-name': require('./rules/rule-name')
  },
  configs: {
    recommended: {
      plugins: ['plugin-name'],
      rules: {
        'plugin-name/rule-name': 'error'
      }
    }
  }
};
```

### 2. 规则实现核心要素

#### 2.1 meta信息
```javascript
meta: {
  type: 'suggestion',           // 规则类型：suggestion, problem, layout
  docs: {
    description: '规则描述',
    category: 'Stylistic Issues',
    recommended: true
  },
  fixable: 'code',              // 是否可自动修复
  schema: [],                   // 规则配置选项
  messages: {                   // 错误消息
    missingSemicolon: '语句缺少分号'
  }
}
```

#### 2.2 create函数
```javascript
create(context) {
  return {
    // 监听AST节点类型
    ExpressionStatement(node) {
      // 检查逻辑
    }
  };
}
```

### 3. 分号检查规则实现步骤

#### 3.1 确定需要检查的节点类型
- `ExpressionStatement` - 表达式语句
- `VariableDeclaration` - 变量声明
- `FunctionDeclaration` - 函数声明
- `ClassDeclaration` - 类声明
- `ImportDeclaration` - 导入声明
- `ExportNamedDeclaration` - 导出声明
- 等等...

#### 3.2 检查分号逻辑
```javascript
function checkSemicolon(node, context) {
  const sourceCode = context.getSourceCode();
  const lastToken = sourceCode.getLastToken(node);
  
  if (lastToken && lastToken.value !== ';') {
    context.report({
      node,
      messageId: 'missingSemicolon',
      fix(fixer) {
        return fixer.insertTextAfter(lastToken, ';');
      }
    });
  }
}
```

### 4. 关键技术点

#### 4.1 AST节点遍历
- 使用ESLint提供的AST节点类型
- 在`create`函数中返回需要监听的节点类型
- 每个节点类型对应一个处理函数

#### 4.2 源码分析
- 使用`context.getSourceCode()`获取源码信息
- 使用`sourceCode.getLastToken(node)`获取节点最后一个token
- 检查token是否为分号

#### 4.3 错误报告
- 使用`context.report()`报告错误
- 提供错误位置、消息和自动修复方案

#### 4.4 自动修复
- 设置`fixable: 'code'`
- 在`fix`函数中使用`fixer.insertTextAfter()`添加分号

### 5. 测试验证

#### 5.1 使用RuleTester
```javascript
const { RuleTester } = require('eslint');
const rule = require('../rules/require-semicolon');

const ruleTester = new RuleTester({
  parserOptions: {
    ecmaVersion: 2020,
    sourceType: 'module'
  }
});

ruleTester.run('require-semicolon', rule, {
  valid: ['const x = 1;'],
  invalid: [{
    code: 'const x = 1',
    errors: [{ messageId: 'missingSemicolon' }],
    output: 'const x = 1;'
  }]
});
```

### 6. 使用方式

#### 6.1 在ESLint配置中启用
```json
{
  "plugins": ["eslint-plugin"],
  "rules": {
    "eslint-plugin/require-semicolon": "error"
  }
}
```

#### 6.2 使用推荐配置
```json
{
  "extends": ["plugin:eslint-plugin/recommended"]
}
```

### 7. 面试回答技巧

#### 7.1 结构化的回答
1. **概述**：说明ESLint插件的基本概念
2. **结构**：解释插件的文件结构和组成部分
3. **实现**：详细说明规则的实现逻辑
4. **技术点**：强调关键的技术要点
5. **测试**：说明如何验证规则的正确性
6. **使用**：展示如何在项目中使用插件

#### 7.2 重点强调
- AST节点遍历机制
- 源码分析和token检查
- 错误报告和自动修复
- 测试覆盖和配置选项

#### 7.3 实际演示
- 展示完整的代码结构
- 说明关键函数的作用
- 解释配置选项的含义

### 8. 扩展思考

#### 8.1 性能优化
- 只监听必要的节点类型
- 避免在规则中进行复杂的计算

#### 8.2 配置灵活性
- 支持不同的错误级别
- 提供配置选项来自定义行为

#### 8.3 维护性
- 清晰的代码结构
- 完善的测试覆盖
- 详细的文档说明

## 总结

编写ESLint插件的核心是理解AST结构、掌握节点遍历机制、实现检查逻辑、提供错误报告和自动修复功能。通过合理的架构设计和充分的测试验证，可以创建出高质量、易维护的ESLint插件。
