<template>
  <div class="v-html-demo">
    <h2>é—®é¢˜2ï¼šä¸èƒ½ä½¿ç”¨ v-html æ¥æ‹¼æ¥ç»„åˆæ¨¡æ¿æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h2>

    <div class="explanation-box">
      <p class="explanation">
        Vue ä¸æ˜¯åŸºäºå­—ç¬¦ä¸²çš„æ¨¡æ¿å¼•æ“ï¼Œä¸èƒ½é€šè¿‡æ‹¼æ¥ HTML å­—ç¬¦ä¸²æ¥ç»„åˆç»„ä»¶ã€‚
        <strong>åº”è¯¥ä½¿ç”¨ç»„ä»¶ç³»ç»Ÿæ¥æ„å»ºå’Œç»„åˆ UIã€‚</strong>
      </p>
    </div>

    <!-- é”™è¯¯ç¤ºä¾‹ -->
    <section class="demo-section error-section">
      <h3>âŒ é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•ç”¨å­—ç¬¦ä¸²æ‹¼æ¥"ç»„ä»¶"</h3>
      <div class="demo-box">
        <h4>é”™è¯¯çš„æ€è·¯ï¼š</h4>
        <div class="code-example">
          <pre><code>// âŒ é”™è¯¯ï¼šå°è¯•é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ¥ç»„åˆç»„ä»¶
const htmlContent = `
  &lt;div class="card"&gt;
    &lt;MyComponent :prop="value" /&gt;
    &lt;h3&gt;{{ title }}&lt;/h3&gt;
    &lt;p&gt;{{ content }}&lt;/p&gt;
  &lt;/div&gt;
`

// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
&lt;div v-html="htmlContent"&gt;&lt;/div&gt;</code></pre>
        </div>
        <h4>å®é™…æ•ˆæœï¼š</h4>
        <div class="result error-result">
          <div v-html="attemptedComponentString"></div>
          <p class="warning-note">
            âŒ <strong>å¤±è´¥åŸå› </strong>ï¼š<br>
            1. MyComponent ä¸ä¼šè¢«è§£æä¸º Vue ç»„ä»¶<br>
            2. {{ title }} å’Œ {{ content }} ä¸ä¼šè¢«è§£æ<br>
            3. åªä¼šæ˜¾ç¤ºä¸ºçº¯ HTML æ–‡æœ¬å­—ç¬¦ä¸²
          </p>
        </div>
      </div>
    </section>

    <!-- æ­£ç¡®ç¤ºä¾‹ -->
    <section class="demo-section success-section">
      <h3>âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨ç»„ä»¶ç³»ç»Ÿ</h3>
      <div class="demo-box">
        <h4>æ­£ç¡®çš„åšæ³•ï¼š</h4>
        <div class="code-example">
          <pre><code>// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Vue ç»„ä»¶ç³»ç»Ÿ
&lt;template&gt;
  &lt;div class="card"&gt;
    &lt;MyComponent :prop="value" /&gt;
    &lt;h3&gt;{{ title }}&lt;/h3&gt;
    &lt;p&gt;{{ content }}&lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
        </div>
        <h4>å®é™…æ•ˆæœï¼š</h4>
        <div class="result success-result">
          <div class="card">
            <SimpleComponent :message="'è¿™æ˜¯é€šè¿‡ç»„ä»¶ä¼ é€’çš„æ¶ˆæ¯'" />
            <h3>{{ title }}</h3>
            <p>{{ content }}</p>
          </div>
          <p class="success-note">
            âœ… <strong>æˆåŠŸåŸå› </strong>ï¼š<br>
            1. SimpleComponent æ­£å¸¸æ¸²æŸ“ä¸º Vue ç»„ä»¶<br>
            2. {{ title }} å’Œ {{ content }} æ­£ç¡®è§£æ<br>
            3. æ”¯æŒå“åº”å¼å’Œæ‰€æœ‰ Vue ç‰¹æ€§
          </p>
        </div>
      </div>
    </section>

    <!-- è¯¦ç»†å¯¹æ¯” -->
    <section class="demo-section comparison-section">
      <h3>ğŸ“Š è¯¦ç»†å¯¹æ¯”ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ vs ç»„ä»¶ç»„åˆ</h3>
      
      <div class="comparison-container">
        <!-- é”™è¯¯æ–¹å¼ -->
        <div class="comparison-card wrong-way">
          <div class="card-header">
            <span class="icon">âŒ</span>
            <h4>é”™è¯¯æ–¹å¼ï¼ˆåŸºäºå­—ç¬¦ä¸²ï¼‰</h4>
          </div>
          <div class="code-example-small">
            <pre><code>// é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
const template = `
  &lt;div class="card"&gt;
    &lt;h3&gt;{{ title }}&lt;/h3&gt;
    &lt;p&gt;{{ content }}&lt;/p&gt;
    &lt;MyComponent :prop="value" /&gt;
  &lt;/div&gt;
`
&lt;div v-html="template"&gt;&lt;/div&gt;</code></pre>
          </div>
          <div class="problems-list">
            <h5>å­˜åœ¨çš„é—®é¢˜ï¼š</h5>
            <ul>
              <li>âŒ {{ title }} å’Œ {{ content }} ä¸ä¼šè¢«è§£æ</li>
              <li>âŒ MyComponent ä¸ä¼šè¢«æ¸²æŸ“ä¸ºç»„ä»¶</li>
              <li>âŒ æ— æ³•ä½¿ç”¨ Vue çš„å“åº”å¼ç‰¹æ€§</li>
              <li>âŒ æ— æ³•ä½¿ç”¨ Vue æŒ‡ä»¤ï¼ˆv-ifã€v-for ç­‰ï¼‰</li>
              <li>âŒ æ²¡æœ‰ç±»å‹æ£€æŸ¥</li>
              <li>âŒ æ— æ³•äº«å— Vue çš„ç¼–è¯‘ä¼˜åŒ–</li>
              <li>âš ï¸ å­˜åœ¨ XSS å®‰å…¨é£é™©</li>
            </ul>
          </div>
        </div>

        <!-- æ­£ç¡®æ–¹å¼ -->
        <div class="comparison-card right-way">
          <div class="card-header">
            <span class="icon">âœ…</span>
            <h4>æ­£ç¡®æ–¹å¼ï¼ˆåŸºäºç»„ä»¶ï¼‰</h4>
          </div>
          <div class="code-example-small">
            <pre><code>// æ­£ç¡®ï¼šä½¿ç”¨ç»„ä»¶
&lt;template&gt;
  &lt;div class="card"&gt;
    &lt;h3&gt;{{ title }}&lt;/h3&gt;
    &lt;p&gt;{{ content }}&lt;/p&gt;
    &lt;MyComponent :prop="value" /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
          </div>
          <div class="advantages-list">
            <h5>ä¼˜åŠ¿ï¼š</h5>
            <ul>
              <li>âœ… å®Œæ•´çš„å“åº”å¼æ”¯æŒ</li>
              <li>âœ… ç»„ä»¶å¯ä»¥æ­£å¸¸æ¸²æŸ“å’Œå¤ç”¨</li>
              <li>âœ… äº«å— Vue ç¼–è¯‘æ—¶ä¼˜åŒ–</li>
              <li>âœ… ç±»å‹æ£€æŸ¥å’Œå·¥å…·æ”¯æŒ</li>
              <li>âœ… æ”¯æŒæ‰€æœ‰ Vue æŒ‡ä»¤</li>
              <li>âœ… æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ</li>
              <li>âœ… é»˜è®¤ XSS é˜²æŠ¤</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- å®é™…åº”ç”¨åœºæ™¯ -->
    <section class="demo-section use-case-section">
      <h3>ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”</h3>
      
      <div class="use-case-box">
        <h4>åœºæ™¯ï¼šåŠ¨æ€æ¸²æŸ“å•†å“å¡ç‰‡åˆ—è¡¨</h4>
        
        <div class="use-case-comparison">
          <div class="use-case-item wrong">
            <h5>âŒ é”™è¯¯åšæ³•ï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰</h5>
            <div class="code-example-small">
              <pre><code>// é”™è¯¯ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
const generateCards = (products) => {
  return products.map(p => `
    &lt;div class="product-card"&gt;
      &lt;img src="${p.image}" /&gt;
      &lt;h3&gt;${p.name}&lt;/h3&gt;
      &lt;p&gt;Â¥${p.price}&lt;/p&gt;
      &lt;button @click="addToCart(${p.id})"&gt;
        åŠ å…¥è´­ç‰©è½¦
      &lt;/button&gt;
    &lt;/div&gt;
  `).join('')
}

&lt;div v-html="generateCards(products)"&gt;&lt;/div&gt;</code></pre>
            </div>
            <div class="issues">
              <p><strong>é—®é¢˜ï¼š</strong></p>
              <ul>
                <li>@click äº‹ä»¶ä¸ä¼šç”Ÿæ•ˆ</li>
                <li>å¦‚æœ products æ›´æ–°ï¼Œä¸ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“</li>
                <li>æ²¡æœ‰ç»„ä»¶å¤ç”¨</li>
              </ul>
            </div>
          </div>

          <div class="use-case-item right">
            <h5>âœ… æ­£ç¡®åšæ³•ï¼ˆç»„ä»¶ç³»ç»Ÿï¼‰</h5>
            <div class="code-example-small">
              <pre><code>// æ­£ç¡®ï¼šä½¿ç”¨ç»„ä»¶
&lt;template&gt;
  &lt;div v-for="product in products" :key="product.id"&gt;
    &lt;ProductCard 
      :product="product"
      @add-to-cart="handleAddToCart"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
            </div>
            <div class="benefits">
              <p><strong>ä¼˜åŠ¿ï¼š</strong></p>
              <ul>
                <li>äº‹ä»¶æ­£å¸¸è§¦å‘</li>
                <li>å“åº”å¼æ›´æ–°ï¼Œproducts å˜åŒ–è‡ªåŠ¨æ¸²æŸ“</li>
                <li>ç»„ä»¶å¯å¤ç”¨ï¼Œæ˜“äºç»´æŠ¤</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- æ€»ç»“ -->
    <section class="demo-section summary-section">
      <h3>ğŸ“ æ€»ç»“</h3>
      <div class="summary-box">
        <div class="key-points">
          <h4>æ ¸å¿ƒè¦ç‚¹ï¼š</h4>
          <ol>
            <li>
              <strong>Vue ä¸æ˜¯å­—ç¬¦ä¸²æ¨¡æ¿å¼•æ“</strong>ï¼š
              Vue ä¼šå°†æ¨¡æ¿ç¼–è¯‘æˆè™šæ‹Ÿ DOMï¼Œè€Œä¸æ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢
            </li>
            <li>
              <strong>v-html çš„å±€é™æ€§</strong>ï¼š
              v-html åªèƒ½æ¸²æŸ“çº¯ HTMLï¼Œä¸èƒ½è§£æ Vue è¯­æ³•å’Œç»„ä»¶
            </li>
            <li>
              <strong>ç»„ä»¶æ˜¯ UI ç»„åˆçš„åŸºæœ¬å•å…ƒ</strong>ï¼š
              åº”è¯¥ä½¿ç”¨ç»„ä»¶ç³»ç»Ÿæ¥æ„å»ºå’Œç»„åˆ UIï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
            </li>
            <li>
              <strong>åŠ¨æ€ç»„ä»¶çš„æ­£ç¡®æ–¹å¼</strong>ï¼š
              å¦‚æœéœ€è¦åŠ¨æ€ç»„ä»¶ï¼Œä½¿ç”¨ <code>&lt;component :is="..."&gt;</code> 
              æˆ–æ¡ä»¶æ¸²æŸ“ <code>v-if</code>
            </li>
          </ol>
        </div>
        
        <div class="recommendation">
          <h4>æ¨èåšæ³•ï¼š</h4>
          <ul>
            <li>âœ… ä½¿ç”¨ç»„ä»¶ç³»ç»Ÿæ„å»º UI</li>
            <li>âœ… ä½¿ç”¨ v-for æ¸²æŸ“åˆ—è¡¨</li>
            <li>âœ… ä½¿ç”¨ v-if/v-show æ¡ä»¶æ¸²æŸ“</li>
            <li>âœ… ä½¿ç”¨ &lt;component :is&gt; åŠ¨æ€ç»„ä»¶</li>
            <li>âŒ é¿å…ä½¿ç”¨ v-html æ‹¼æ¥æ¨¡æ¿</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup lang="ts" name="é—®é¢˜2-æ‹¼æ¥ç»„åˆæ¨¡æ¿">
import { ref } from 'vue'
import SimpleComponent from './SimpleComponent.vue'

// é”™è¯¯ç¤ºä¾‹ï¼šå°è¯•æ‹¼æ¥ç»„ä»¶
const attemptedComponentString = ref(`
  <div style="padding: 15px; background: #fff1f0; border: 2px dashed #ff4d4f; border-radius: 6px;">
    <p style="color: #cf1322; margin: 0 0 10px 0;"><strong>âŒ å°è¯•æ‹¼æ¥ç»„ä»¶çš„ç»“æœï¼š</strong></p>
    <p style="margin: 5px 0; color: #cf1322;">
      &lt;MyComponent :prop="value" /&gt;
    </p>
    <p style="margin: 5px 0; color: #cf1322;">
      {{ title }}
    </p>
    <p style="margin: 5px 0; color: #cf1322; font-size: 12px;">
      è¿™äº›éƒ½ä¸ä¼šè¢«è§£æï¼Œåªä¼šæ˜¾ç¤ºä¸ºçº¯æ–‡æœ¬ï¼
    </p>
  </div>
`)

// æ­£ç¡®ç¤ºä¾‹çš„æ•°æ®
const title = ref('æ­£ç¡®çš„æ ‡é¢˜')
const content = ref('è¿™æ˜¯é€šè¿‡ Vue ç»„ä»¶ç³»ç»Ÿæ­£ç¡®æ¸²æŸ“çš„å†…å®¹ï¼Œæ”¯æŒå“åº”å¼æ›´æ–°ï¼')
</script>

<style scoped>
.v-html-demo {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

h2 {
  color: #2c3e50;
  border-bottom: 3px solid #42b983;
  padding-bottom: 10px;
  margin-bottom: 30px;
}

.explanation-box {
  background: #e8f5e9;
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 30px;
  border-left: 4px solid #4caf50;
}

.explanation {
  margin: 0;
  line-height: 1.8;
  color: #2e7d32;
}

.explanation code {
  background: #c8e6c9;
  padding: 2px 6px;
  border-radius: 3px;
}

.demo-section {
  margin: 30px 0;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 8px;
  border-left: 4px solid #42b983;
}

.demo-section.error-section {
  background: #fff1f0;
  border-left-color: #ff4d4f;
}

.demo-section.success-section {
  background: #f6ffed;
  border-left-color: #52c41a;
}

.demo-section.comparison-section {
  background: #fff3e0;
  border-left-color: #ff9800;
}

.demo-section.use-case-section {
  background: #e3f2fd;
  border-left-color: #2196f3;
}

.demo-section.summary-section {
  background: #f3e5f5;
  border-left-color: #9c27b0;
}

h3 {
  color: #2c3e50;
  margin-top: 0;
  font-size: 1.3em;
}

.demo-box {
  margin: 20px 0;
  padding: 20px;
  background: white;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.demo-box h4 {
  color: #42b983;
  margin: 15px 0 10px 0;
}

.code-example {
  background: #263238;
  color: #aed581;
  padding: 15px;
  border-radius: 6px;
  overflow-x: auto;
  margin: 15px 0;
}

.code-example pre {
  margin: 0;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  line-height: 1.6;
}

.code-example-small {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 4px;
  overflow-x: auto;
  margin: 10px 0;
  border-left: 3px solid #42b983;
}

.code-example-small pre {
  margin: 0;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  line-height: 1.5;
  color: #2c3e50;
}

.result {
  margin: 15px 0;
  padding: 15px;
  background: #fafafa;
  border-radius: 6px;
  border: 1px solid #e0e0e0;
}

.error-result {
  border: 2px solid #ff4d4f;
  background: #fff1f0;
}

.success-result {
  border: 2px solid #52c41a;
  background: #f6ffed;
}

.card {
  padding: 15px;
  background: white;
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.card h3 {
  color: #2c3e50;
  margin: 10px 0;
}

.warning-note,
.success-note {
  padding: 12px;
  border-radius: 6px;
  margin-top: 15px;
  line-height: 1.8;
}

.warning-note {
  color: #cf1322;
  background: #fff1f0;
  border-left: 3px solid #ff4d4f;
}

.success-note {
  color: #389e0d;
  background: #f6ffed;
  border-left: 3px solid #52c41a;
}

.comparison-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 20px;
}

.comparison-card {
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.wrong-way {
  background: #fff1f0;
  border: 2px solid #ff4d4f;
}

.right-way {
  background: #f6ffed;
  border: 2px solid #52c41a;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 2px solid currentColor;
}

.card-header .icon {
  font-size: 24px;
}

.wrong-way .card-header {
  color: #cf1322;
  border-bottom-color: #ff4d4f;
}

.right-way .card-header {
  color: #389e0d;
  border-bottom-color: #52c41a;
}

.problems-list,
.advantages-list {
  margin-top: 15px;
}

.problems-list h5,
.advantages-list h5 {
  margin: 10px 0;
  color: #2c3e50;
}

.problems-list ul,
.advantages-list ul {
  margin: 0;
  padding-left: 20px;
}

.problems-list li,
.advantages-list li {
  margin: 8px 0;
  line-height: 1.6;
}

.use-case-box {
  background: white;
  padding: 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.use-case-box h4 {
  color: #2196f3;
  margin-top: 0;
}

.use-case-comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 15px;
}

.use-case-item {
  padding: 15px;
  border-radius: 6px;
}

.use-case-item.wrong {
  background: #fff1f0;
  border: 2px solid #ff4d4f;
}

.use-case-item.right {
  background: #f6ffed;
  border: 2px solid #52c41a;
}

.use-case-item h5 {
  margin-top: 0;
  color: #2c3e50;
}

.issues,
.benefits {
  margin-top: 10px;
}

.issues ul,
.benefits ul {
  margin: 8px 0 0 0;
  padding-left: 20px;
}

.issues li,
.benefits li {
  margin: 5px 0;
  line-height: 1.6;
}

.summary-box {
  background: white;
  padding: 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.key-points,
.recommendation {
  margin: 20px 0;
}

.key-points h4,
.recommendation h4 {
  color: #9c27b0;
  margin-bottom: 10px;
}

.key-points ol,
.recommendation ul {
  margin: 0;
  padding-left: 25px;
}

.key-points li,
.recommendation li {
  margin: 12px 0;
  line-height: 1.8;
  color: #2c3e50;
}

.summary-box code {
  background: #f5f5f5;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
  color: #e83e8c;
}

@media (max-width: 768px) {
  .comparison-container,
  .use-case-comparison {
    grid-template-columns: 1fr;
  }

  .v-html-demo {
    padding: 15px;
  }
}
</style>
